#!/bin/bash

# 进入脚本所在目录（避免从其他路径执行时错位）
cd "$(dirname "$0")" || exit 1

PROJECT_DIR="$(pwd)"
LOCAL_NODE_MODULES="$HOME/.local-node-modules/webapp-template/node_modules"

echo "项目目录: $PROJECT_DIR"
echo "目标 node_modules: $LOCAL_NODE_MODULES"
echo ""

# 确保本地 node_modules 存在
mkdir -p "$LOCAL_NODE_MODULES"

# 删除项目原来的 node_modules（可能是目录或坏软链）
echo "删除原有 node_modules..."
rm -rf node_modules

# 创建软链接
echo "创建软链接..."
ln -s "$LOCAL_NODE_MODULES" node_modules

echo ""
echo "✅ 已建立软链接："
ls -ld node_modules

echo ""
echo "➡ 接下来执行： pnpm install"
echo "（依赖会安装到你的本地硬盘，而不是 NAS）"